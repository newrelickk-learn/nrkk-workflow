# ç”³è«‹æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 

PHP Laravel + MariaDBã§æ§‹ç¯‰ã•ã‚ŒãŸç°¡æ˜“çš„ãªç”³è«‹æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## ä¸»è¦æ©Ÿèƒ½

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- **å½¹å‰²ãƒ™ãƒ¼ã‚¹èªè¨¼**: ç”³è«‹è€…ã€ç¢ºèªè€…ã€æ‰¿èªè€…ã€ç®¡ç†è€…ã®4ã¤ã®å½¹å‰²
- **éƒ¨ç½²ãƒ»å½¹è·ç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®éƒ¨ç½²ã¨å½¹è·æƒ…å ±

### ç”³è«‹ç®¡ç†
- **ç”³è«‹ä½œæˆãƒ»ç·¨é›†**: ã‚¿ã‚¤ãƒˆãƒ«ã€å†…å®¹ã€ç¨®åˆ¥ã€å„ªå…ˆåº¦ã€é‡‘é¡ãªã©è©³ç´°ãªç”³è«‹æƒ…å ±
- **ç”³è«‹ç¨®åˆ¥**: çµŒè²»ç”³è«‹ã€ä¼‘æš‡ç”³è«‹ã€è³¼å…¥ç”³è«‹ã€ãã®ä»–
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**: ä¸‹æ›¸ãã€æå‡ºæ¸ˆã¿ã€ç¢ºèªä¸­ã€æ‰¿èªæ¸ˆã¿ã€å´ä¸‹ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- **æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«**: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ·»ä»˜å¯¾å¿œ

### æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **æŸ”è»Ÿãªãƒ•ãƒ­ãƒ¼è¨­å®š**: ç”³è«‹ç¨®åˆ¥ã”ã¨ã®æ‰¿èªãƒ•ãƒ­ãƒ¼å®šç¾©
- **2æ®µéšæ‰¿èª**: ç¢ºèªâ†’æ‰¿èªã®æ®µéšçš„å‡¦ç†
- **æ¡ä»¶åˆ†å²**: é‡‘é¡ã‚„ç”³è«‹å†…å®¹ã«ã‚ˆã‚‹è‡ªå‹•ãƒ•ãƒ­ãƒ¼é¸æŠ
- **ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½**: å„æ®µéšã§ã®ã‚³ãƒ¡ãƒ³ãƒˆãƒ»ç†ç”±è¨˜éŒ²

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- **çµ±è¨ˆæƒ…å ±**: ç”³è«‹æ•°ã€æ‰¿èªå¾…ã¡ä»¶æ•°ãªã©ã®å¯è¦–åŒ–
- **é€šçŸ¥æ©Ÿèƒ½**: æ‰¿èªå¾…ã¡æ¡ˆä»¶ã®ä¸€è¦§è¡¨ç¤º
- **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿**: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ç¨®åˆ¥ã€ç”³è«‹è€…ã§ã®çµã‚Šè¾¼ã¿

## æŠ€è¡“ä»•æ§˜

- **è¨€èª**: PHP 8.1+
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Laravel 10+
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: MariaDB/MySQL
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Laravel Blade + Bootstrap 5
- **èªè¨¼**: Laravelæ¨™æº–èªè¨¼

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
- åŸºæœ¬æƒ…å ±: name, email, password
- å½¹å‰²: role (applicant/reviewer/approver/admin)
- çµ„ç¹”æƒ…å ±: department, position

### applicationsï¼ˆç”³è«‹ï¼‰
- ç”³è«‹æƒ…å ±: title, description, type, status
- é‡‘é¡ãƒ»æ—¥ç¨‹: amount, requested_date, due_date
- é–¢ä¿‚: applicant_id â†’ users

### approval_flowsï¼ˆæ‰¿èªãƒ•ãƒ­ãƒ¼ï¼‰
- ãƒ•ãƒ­ãƒ¼è¨­å®š: name, application_type, step_count
- æ¡ä»¶è¨­å®š: conditions (JSON)
- ã‚¹ãƒ†ãƒƒãƒ—è¨­å®š: flow_config (JSON)

### approvalsï¼ˆæ‰¿èªå±¥æ­´ï¼‰
- æ‰¿èªæƒ…å ±: application_id, approver_id, step_number
- ç¨®åˆ¥: step_type (review/approve)
- çµæœ: status, comment, acted_at

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Dockerã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰

#### 1. ç’°å¢ƒè¦ä»¶
- Docker
- Docker Compose
- Python 3.xï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œç”¨ï¼‰

#### 2. NewRelicç‰ˆDockerç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

##### å®Œå…¨ãªãƒ“ãƒ«ãƒ‰ã‹ã‚‰ãƒ†ã‚¹ãƒˆã¾ã§ã®ä¸€æ‹¬å®Ÿè¡Œ
```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd nrkk-workflow

# NewRelicç‰ˆDockerã®ãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’ä¸€æ‹¬ã§è¡Œã†
docker-compose -f docker-compose.newrelic.yml build && \
docker-compose -f docker-compose.newrelic.yml down && \
docker-compose -f docker-compose.newrelic.yml up -d && \
test_env/bin/python tests/test_create_applications.py && \
test_env/bin/python tests/test_approve_applications.py
```

##### å€‹åˆ¥å®Ÿè¡Œã™ã‚‹å ´åˆ
```bash
# 1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
docker-compose -f docker-compose.newrelic.yml build

# 2. æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ãƒ»å‰Šé™¤
docker-compose -f docker-compose.newrelic.yml down

# 3. ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œï¼‰
docker-compose -f docker-compose.newrelic.yml up -d

# 4. ç”³è«‹ä½œæˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
test_env/bin/python tests/test_create_applications.py

# 5. æ‰¿èªå‡¦ç†ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
test_env/bin/python tests/test_approve_applications.py
```

#### 3. ã‚¢ã‚¯ã‚»ã‚¹
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: http://localhost:8080
- **phpMyAdmin**: http://localhost:8081

#### 4. ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆåˆå›ã®ã¿ï¼‰
```bash
# Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆ
python3 -m venv test_env

# ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source test_env/bin/activate  # macOS/Linux
# ã¾ãŸã¯
test_env\Scripts\activate  # Windows

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install requests python-dotenv
```

#### 5. ãã®ä»–ã®Dockeræ“ä½œã‚³ãƒãƒ³ãƒ‰
```bash
# ãƒ­ã‚°ç¢ºèª
docker-compose -f docker-compose.newrelic.yml logs -f

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å«ã‚€ï¼‰
docker-compose -f docker-compose.newrelic.yml down -v

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
docker-compose -f docker-compose.newrelic.yml exec app php artisan migrate
docker-compose -f docker-compose.newrelic.yml exec app php artisan tinker

# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker-compose -f docker-compose.newrelic.yml ps
```

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. ç’°å¢ƒè¦ä»¶
- PHP 8.1ä»¥ä¸Š
- Composer
- MariaDB/MySQL 5.7ä»¥ä¸Š
- Node.js (ä»»æ„ - ã‚¢ã‚»ãƒƒãƒˆç®¡ç†ç”¨)

#### 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd nrkk-workflow

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
composer install

# ç’°å¢ƒè¨­å®š
cp .env.example .env
php artisan key:generate
```

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=approval_workflow
DB_USERNAME=root
DB_PASSWORD=

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
mysql -u root -p -e "CREATE DATABASE approval_workflow;"

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
php artisan migrate

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
php artisan db:seed
```

#### 4. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
php artisan serve
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:8000` ã«ã‚¢ã‚¯ã‚»ã‚¹

## ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

### ç®¡ç†è€…
| å½¹å‰² | åå‰ | ãƒ¡ãƒ¼ãƒ« | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
|------|------|--------|------------|
| ç®¡ç†è€… | ç®¡ç†è€… | admin@wf.nrkk.technology | password |

### ç”³è«‹è€…ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
| åå‰ | ãƒ¡ãƒ¼ãƒ« | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | çµ„ç¹” |
|------|--------|------------|------|
| æ˜Ÿé‡å’Œå­ | hoshino.kazuko@wf.nrkk.technology | password | ãƒ†ãƒƒã‚¯ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ |
| ç¬¹ç”°ç´”å­ | sasada.junko@wf.nrkk.technology | password | ãƒ†ãƒƒã‚¯ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ |
| æ–‰è—¤å’Œæ˜ | saito.kazuaki@wf.nrkk.technology | password | ã‚°ãƒªãƒ¼ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼ |
| é’æœ¨ç¿”å¤ª | aoki.shota@wf.nrkk.technology | password | ã‚„ã¾ã¨å»ºè¨­ |
| çŸ³å·ç”±ç´€ | ishikawa.yuki@wf.nrkk.technology | password | ã¿ã©ã‚Šé£Ÿå“å·¥æ¥­ |

### æ‰¿èªè€…ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
| åå‰ | ãƒ¡ãƒ¼ãƒ« | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | çµ„ç¹” |
|------|--------|------------|------|
| ä¸­æ‘æµå­ | nakamura.keiko@wf.nrkk.technology | password | ãƒ†ãƒƒã‚¯ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ |
| æœ¨æ‘æ™ºå­ | kimura.tomoko@wf.nrkk.technology | password | ã‚°ãƒªãƒ¼ãƒ³ã‚¨ãƒãƒ«ã‚®ãƒ¼ |
| ä½è—¤å¤ªéƒ | sato.taro@wf.nrkk.technology | password | ã¿ã©ã‚Šé£Ÿå“å·¥æ¥­ |
| éˆ´æœ¨èŠ±å­ | suzuki.hanako@wf.nrkk.technology | password | ã•ãã‚‰é‹è¼¸ |

> ğŸ’¡ **æ³¨æ„**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ `password` ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

## åŸºæœ¬çš„ãªä½¿ç”¨ãƒ•ãƒ­ãƒ¼

1. **ç”³è«‹è€…**ãŒæ–°è¦ç”³è«‹ã‚’ä½œæˆ
2. ç”³è«‹å†…å®¹ã«å¿œã˜ã¦**æ‰¿èªãƒ•ãƒ­ãƒ¼**ãŒè‡ªå‹•é¸æŠ
3. **ç¢ºèªè€…**ãŒç”³è«‹å†…å®¹ã‚’ç¢ºèª
4. **æ‰¿èªè€…**ãŒæœ€çµ‚æ‰¿èª
5. ç”³è«‹è€…ã«çµæœé€šçŸ¥

## ç”³è«‹æ‰¿èªã®è©³ç´°ãƒ•ãƒ­ãƒ¼

### ä¸€èˆ¬ç”³è«‹ãƒ•ãƒ­ãƒ¼
1. ç¢ºèªï¼ˆreviewerï¼‰
2. æ‰¿èªï¼ˆapproverï¼‰

### é«˜é¡çµŒè²»ç”³è«‹ãƒ•ãƒ­ãƒ¼ï¼ˆ10ä¸‡å††ä»¥ä¸Šï¼‰
1. ç¢ºèªï¼ˆreviewerï¼‰
2. æ‰¿èªï¼ˆapproverï¼‰
3. æœ€çµ‚æ‰¿èªï¼ˆadminï¼‰

### ä¼‘æš‡ç”³è«‹ãƒ•ãƒ­ãƒ¼
1. æ‰¿èªï¼ˆapproverï¼‰

## APIæ‹¡å¼µ

å°†æ¥çš„ã«REST APIã¨ã—ã¦æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚

```php
// ä¾‹: API Routes
Route::apiResource('applications', ApplicationController::class);
Route::post('applications/{application}/submit', [ApplicationController::class, 'submit']);
```

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ

### æ‰¿èªãƒ•ãƒ­ãƒ¼ã®è¿½åŠ 
`ApprovalFlow`ãƒ¢ãƒ‡ãƒ«ã§æ–°ã—ã„ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©

### ç”³è«‹ç¨®åˆ¥ã®è¿½åŠ 
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§`applications.type`ã®enumã‚’æ‹¡å¼µ

### é€šçŸ¥æ©Ÿèƒ½ã®å®Ÿè£…
Laravel Notificationã‚’ä½¿ç”¨ã—ãŸé€šçŸ¥æ©Ÿèƒ½è¿½åŠ å¯èƒ½

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- CSRFä¿è­·
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- XSSå¯¾ç­–
- èªå¯ãƒãƒªã‚·ãƒ¼ï¼ˆPolicyï¼‰ã«ã‚ˆã‚‹æ¨©é™åˆ¶å¾¡

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**Q: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**
```bash
php artisan migrate:fresh --seed
```

**Q: æ¨©é™ã‚¨ãƒ©ãƒ¼**
```bash
sudo chown -R $USER:www-data storage/
sudo chmod -R 775 storage/
```

**Q: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢**
```bash
php artisan cache:clear
php artisan config:clear
php artisan view:clear
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ã‚µãƒãƒ¼ãƒˆ

Issueå ±å‘Šã‚„ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚